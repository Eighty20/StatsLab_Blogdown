<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices --> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    	
    <meta name="generator" content="Hugo 0.37.1" />
    
    <title>Dealing with nested data &middot; </title>
    <meta content="Dealing with nested data - " property="og:title">
    <meta content=" - " property="og:description">    
    <!-- CSS --> 
    <link rel="stylesheet" href="../../css/print.css" media="print">
    <link rel="stylesheet" href="../../css/poole.css">
    <link rel="stylesheet" href="../../css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,500">
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <!-- highlight.js--> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="../../css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="../../favicon.png">
    

	</head>
    <body>
        <div class="sidebar">
	<div class="container text-center sidebar-sticky">
		<div class="sidebar-about text-center">
			<a href="../../"><h1 class="brand">StatsLab</h1></a>
			 <img src="../../img/stats.png" alt="Author Image" class="img-circle headshot center"> 
			<p class="lead">
				 Internal initiative at <br> <a href="http://www.eighty20.co.za/"> Eighty20</a> <br> We love R and Python 
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="../../posts/"> <span>Posts</span></a>
				</li>
				<li>
					<a href="../../about_me/"> <span>About</span></a>
				</li>
				<li>
					<a href="../../tags/"> <span>Search by Tag</span></a>
				</li>
		</li>
	</ul>
</div>

        <p>
		<section class="row text-center">
	
	
	
	
	
	
	
	
	
	
</section>

        </p>
        </p>
	</div>
	<div>
	</div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Dealing with nested data</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       <i class="fa fa-calendar" aria-hidden="true"></i> Mar 3, 2018 
      
      
        
        
            in
            
            
                <a class="meta" href="../../categories/r">R</a>
                
            
        
      
      
      
        
        
            <br/>
             <i class="fa fa-tags" aria-hidden="true"></i>
            
            <a class="meta" href="../../tags/api">api</a> 
        
            <a class="meta" href="../../tags/data-wrangling">data-wrangling</a> 
        
            <a class="meta" href="../../tags/jsonlite">jsonlite</a> 
        
            <a class="meta" href="../../tags/purrr">purrr</a>
        
      
      
      </span>  
  </div>    
  
  <p>Dealing with nested data can be really frustrating…<br />
Especially if you want to keep your workspace nice and tidy with all your data in tables!</p>
<p>With no actual experience trying to get at these nested tibbles can seem almost impossible:</p>
<!-- <iframe src="https://giphy.com/embed/Bqn8Z7xdPCFy0" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/water-funny-Bqn8Z7xdPCFy0">via GIPHY</a></p> -->
<div class="figure">
<img src="../../Pictures/water_giff.gif" />

</div>
<div id="downloading-data-from-an-api-created-by-blizzard" class="section level2">
<h2>Downloading data from an api created by Blizzard</h2>
<p>To illustrate how you would deal with nested data I found an api that let’s you download all kinds of data on the e-sport/game called Overwatch. By downloading this game data you could make all kinds of predictions for your fantasy league team etc.</p>
<p>According to a response from the api…</p>
<p>List of api requests possible:<br />
- /rankings - returns current rankings<br />
- /schedule - returns current schedule including past matches<br />
- /matches - Returns all matches<br />
- /matches/:matchID<br />
- /match - Returns all matches<br />
- /match/:matchID - Returns a specific match<br />
- /teams - Returns all teams<br />
- /teams/:TeamID - Returns a specific team<br />
- /news - Returns all news items<br />
- /news/:blogID - Returns a specified news item<br />
- /data/countries - Returns list of countries<br />
- /v2/email - Unsure what this does, but it was in the js<br />
- /live-match - Presumably returns live data for a match?<br />
- /v2/streams - Returns owl stream links<br />
- /maps - Returns list of maps<br />
- /vods - Returns list of vods for prior matches</p>
<div id="get-some-data" class="section level3">
<h3>Get some data…</h3>
<p>First we can get some data on the maps played…</p>
<pre class="r"><code>data_request &lt;-
  httr::GET(url = &quot;https://api.overwatchleague.com/maps&quot;)

data_content &lt;- 
  data_request %&gt;% 
  httr::content()</code></pre>
<p>What is in here?</p>
<pre class="r"><code>data_content[[1]] %&gt;% 
  names</code></pre>
<pre><code>## [1] &quot;id&quot;           &quot;name&quot;         &quot;background&quot;   &quot;icon&quot;        
## [5] &quot;type&quot;         &quot;description&quot;  &quot;thumbnail&quot;    &quot;map&quot;         
## [9] &quot;esportsApiId&quot;</code></pre>
<p>Which of these are nested deeper?</p>
<pre class="r"><code>data_types &lt;- 
  as.data.frame(data_content[[1]] %&gt;% map_chr(class)) %&gt;% 
  setNames(&quot;data_type&quot;)

data_types</code></pre>
<pre><code>##              data_type
## id           character
## name              list
## background   character
## icon         character
## type         character
## description       list
## thumbnail    character
## map               list
## esportsApiId character</code></pre>
<pre class="r"><code>owl_map_df &lt;-
  fromJSON(&quot;https://api.overwatchleague.com/maps&quot;, flatten = TRUE) %&gt;% 
  select(id,type, esportsApiId,everything())

owl_map_df %&gt;% 
  names</code></pre>
<pre><code>##  [1] &quot;id&quot;                &quot;type&quot;              &quot;esportsApiId&quot;     
##  [4] &quot;background&quot;        &quot;icon&quot;              &quot;thumbnail&quot;        
##  [7] &quot;name.en_US&quot;        &quot;name.es_MX&quot;        &quot;name.pt_BR&quot;       
## [10] &quot;name.de_DE&quot;        &quot;name.en_GB&quot;        &quot;name.es_ES&quot;       
## [13] &quot;name.fr_FR&quot;        &quot;name.it_IT&quot;        &quot;name.pl_PL&quot;       
## [16] &quot;name.ru_RU&quot;        &quot;name.ko_KR&quot;        &quot;name.zh_TW&quot;       
## [19] &quot;name.zh_CN&quot;        &quot;name.ja_JP&quot;        &quot;description.en_US&quot;
## [22] &quot;description.es_MX&quot; &quot;description.pt_BR&quot; &quot;description.de_DE&quot;
## [25] &quot;description.en_GB&quot; &quot;description.es_ES&quot; &quot;description.fr_FR&quot;
## [28] &quot;description.it_IT&quot; &quot;description.pl_PL&quot; &quot;description.ru_RU&quot;
## [31] &quot;description.ko_KR&quot; &quot;description.zh_TW&quot; &quot;description.zh_CN&quot;
## [34] &quot;description.ja_JP&quot; &quot;map.href&quot;</code></pre>
<p>This wasn’t too bad… Let’s get some teams!!</p>
</div>
<div id="teams" class="section level3">
<h3>Teams?</h3>
<p>Can we also build a lookup table for teams?</p>
<p>What does the staging response look like?</p>
<pre class="r"><code>owl_teams_df &lt;-
  fromJSON(&quot;https://api.overwatchleague.com/teams&quot;, flatten = TRUE) 

owl_teams_df %&gt;% 
  names</code></pre>
<pre><code>## [1] &quot;id&quot;                 &quot;availableLanguages&quot; &quot;name&quot;              
## [4] &quot;description&quot;        &quot;competitors&quot;        &quot;game&quot;              
## [7] &quot;logo&quot;               &quot;owl_divisions&quot;      &quot;strings&quot;</code></pre>
<p>Let’s clean this</p>
<p>First we do the teams:</p>
<pre class="r"><code>teams_cleaned_df &lt;- 
  owl_teams_df$competitors %&gt;% 
  select(competitor.name,competitor.id,competitor.handle,competitor.abbreviatedName) %&gt;% 
  tbl_df()

teams_cleaned_df</code></pre>
<pre><code>## # A tibble: 12 x 4
##    competitor.name        competitor.id competitor.handle competitor.abbr…
##  * &lt;chr&gt;                          &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;           
##  1 Dallas Fuel                     4523 fuel.6990         DAL             
##  2 Philadelphia Fusion             4524 fusion.2056       PHI             
##  3 Houston Outlaws                 4525 houston.4749      HOU             
##  4 Boston Uprising                 4402 boston.8698       BOS             
##  5 New York Excelsior              4403 new-york-city.16… NYE             
##  6 San Francisco Shock             4404 san-francisco.38… SFS             
##  7 Los Angeles Valiant             4405 los-angeles-a.27… VAL             
##  8 Los Angeles Gladiators          4406 los-angeles-b.38… GLA             
##  9 Florida Mayhem                  4407 miami-orlando.68… FLA             
## 10 Shanghai Dragons                4408 shanghai.1319     SHD             
## 11 Seoul Dynasty                   4409 seoul.1029        SEO             
## 12 London Spitfire                 4410 london.6950       LDN</code></pre>
<p>And now the players!</p>
<pre class="r"><code>players_cleaned_df &lt;- 
  owl_teams_df$competitors$competitor.players %&gt;% 
  map(~.x %&gt;% select(player.id,team.id,player.availableLanguages,player.handle,player.name,player.homeLocation,player.familyName,player.nationality,player.attributes.heroes,player.attributes.player_number,player.attributes.role)) %&gt;% 
  reduce(bind_rows) %&gt;% 
  tbl_df()

players_cleaned_df %&gt;% glimpse</code></pre>
<pre><code>## Observations: 126
## Variables: 11
## $ player.id                       &lt;int&gt; 3660, 3985, 4658, 5717, 3380, ...
## $ team.id                         &lt;int&gt; 4523, 4523, 4523, 4523, 4523, ...
## $ player.availableLanguages       &lt;list&gt; [&quot;en&quot;, &quot;en&quot;, &lt;&quot;en&quot;, &quot;ko&quot;&gt;, &quot;e...
## $ player.handle                   &lt;chr&gt; &quot;harryhook.5132&quot;, &quot;akm.8009&quot;, ...
## $ player.name                     &lt;chr&gt; &quot;HarryHook&quot;, &quot;aKm&quot;, &quot;Rascal&quot;, ...
## $ player.homeLocation             &lt;chr&gt; &quot;Asturias&quot;, &quot;Angoulême&quot;, &quot;Seou...
## $ player.familyName               &lt;chr&gt; &quot;Tejedor Rua&quot;, &quot;Bignet&quot;, &quot;Kim&quot;...
## $ player.nationality              &lt;chr&gt; &quot;ES&quot;, &quot;FR&quot;, &quot;KR&quot;, &quot;KR&quot;, &quot;FI&quot;, ...
## $ player.attributes.heroes        &lt;list&gt; [&lt;&quot;lucio&quot;, &quot;soldier-76&quot;, &quot;zen...
## $ player.attributes.player_number &lt;int&gt; 9, 5, 27, 2, 13, 10, 4, 7, 23,...
## $ player.attributes.role          &lt;chr&gt; &quot;support&quot;, &quot;offense&quot;, &quot;offense...</code></pre>
<p>So with the players we do have some nested fields but these are just vectors…</p>
<p>For now we will do 2 things;<br />
1. We will keep the nested fields because we could unnest and invert the data to uncover relationships between character preferences and win rates for example…<br />
2. We will create 2 new fields to describe these nested fields.</p>
<pre class="r"><code>players_cleaned_df %&lt;&gt;% 
  mutate(player.nr_of_languages = player.availableLanguages %&gt;% map_int(length)) %&gt;% 
  mutate(player.nr_of_heros = player.attributes.heroes %&gt;% map_int(length)) 

players_cleaned_df %&gt;% 
  select(player.id,player.nr_of_languages,player.nr_of_heros)</code></pre>
<pre><code>## # A tibble: 126 x 3
##    player.id player.nr_of_languages player.nr_of_heros
##        &lt;int&gt;                  &lt;int&gt;              &lt;int&gt;
##  1      3660                      1                  3
##  2      3985                      1                  2
##  3      4658                      2                  3
##  4      5717                      1                  2
##  5      3380                      1                  3
##  6      3577                      1                  3
##  7      4125                      1                  3
##  8      3969                      1                  3
##  9      4608                      1                  3
## 10      4618                      1                  3
## # ... with 116 more rows</code></pre>
<p>OK great! Now we have some player and team data, let’s start by joining these to get ready for the join to matches played and their results…</p>
<p>Does the ids match?</p>
<pre class="r"><code>players_cleaned_df$team.id %in% teams_cleaned_df$competitor.id %&gt;% any()</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Yes, so we can join on this:</p>
<pre class="r"><code>players_cleaned_df &lt;- 
players_cleaned_df %&gt;% 
  left_join(teams_cleaned_df, by = c(&quot;team.id&quot; = &quot;competitor.id&quot;))

players_cleaned_df %&gt;% 
  glimpse</code></pre>
<pre><code>## Observations: 126
## Variables: 16
## $ player.id                       &lt;int&gt; 3660, 3985, 4658, 5717, 3380, ...
## $ team.id                         &lt;int&gt; 4523, 4523, 4523, 4523, 4523, ...
## $ player.availableLanguages       &lt;list&gt; [&quot;en&quot;, &quot;en&quot;, &lt;&quot;en&quot;, &quot;ko&quot;&gt;, &quot;e...
## $ player.handle                   &lt;chr&gt; &quot;harryhook.5132&quot;, &quot;akm.8009&quot;, ...
## $ player.name                     &lt;chr&gt; &quot;HarryHook&quot;, &quot;aKm&quot;, &quot;Rascal&quot;, ...
## $ player.homeLocation             &lt;chr&gt; &quot;Asturias&quot;, &quot;Angoulême&quot;, &quot;Seou...
## $ player.familyName               &lt;chr&gt; &quot;Tejedor Rua&quot;, &quot;Bignet&quot;, &quot;Kim&quot;...
## $ player.nationality              &lt;chr&gt; &quot;ES&quot;, &quot;FR&quot;, &quot;KR&quot;, &quot;KR&quot;, &quot;FI&quot;, ...
## $ player.attributes.heroes        &lt;list&gt; [&lt;&quot;lucio&quot;, &quot;soldier-76&quot;, &quot;zen...
## $ player.attributes.player_number &lt;int&gt; 9, 5, 27, 2, 13, 10, 4, 7, 23,...
## $ player.attributes.role          &lt;chr&gt; &quot;support&quot;, &quot;offense&quot;, &quot;offense...
## $ player.nr_of_languages          &lt;int&gt; 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, ...
## $ player.nr_of_heros              &lt;int&gt; 3, 2, 3, 2, 3, 3, 3, 3, 3, 3, ...
## $ competitor.name                 &lt;chr&gt; &quot;Dallas Fuel&quot;, &quot;Dallas Fuel&quot;, ...
## $ competitor.handle               &lt;chr&gt; &quot;fuel.6990&quot;, &quot;fuel.6990&quot;, &quot;fue...
## $ competitor.abbreviatedName      &lt;chr&gt; &quot;DAL&quot;, &quot;DAL&quot;, &quot;DAL&quot;, &quot;DAL&quot;, &quot;D...</code></pre>
<p>Seems like we have a complete dataset on teams and their players with some usefull features describing them.</p>
<p>Now we need to get some actual match data!</p>
</div>
</div>
<div id="get-some-matches" class="section level2">
<h2>Get some matches</h2>
<pre class="r"><code>owl_matches_df &lt;-
  fromJSON(&quot;https://api.overwatchleague.com/matches&quot;, flatten = TRUE) 

owl_matches_df %&gt;% 
  names</code></pre>
<pre><code>## [1] &quot;content&quot;          &quot;totalPages&quot;       &quot;totalElements&quot;   
## [4] &quot;last&quot;             &quot;numberOfElements&quot; &quot;size&quot;            
## [7] &quot;number&quot;           &quot;sort&quot;             &quot;first&quot;</code></pre>
<p>Huh… Well, contents is a deep structure; let’s go scavenging for easter eggs</p>
<pre class="r"><code>owl_matches_df$content %&gt;% 
  names</code></pre>
<pre><code>##  [1] &quot;id&quot;                                                      
##  [2] &quot;competitors&quot;                                             
##  [3] &quot;scores&quot;                                                  
##  [4] &quot;conclusionValue&quot;                                         
##  [5] &quot;conclusionStrategy&quot;                                      
##  [6] &quot;state&quot;                                                   
##  [7] &quot;games&quot;                                                   
##  [8] &quot;clientHints&quot;                                             
##  [9] &quot;dateCreated&quot;                                             
## [10] &quot;flags&quot;                                                   
## [11] &quot;handle&quot;                                                  
## [12] &quot;startDate&quot;                                               
## [13] &quot;endDate&quot;                                                 
## [14] &quot;showStartTime&quot;                                           
## [15] &quot;showEndTime&quot;                                             
## [16] &quot;winner.id&quot;                                               
## [17] &quot;winner.availableLanguages&quot;                               
## [18] &quot;winner.handle&quot;                                           
## [19] &quot;winner.name&quot;                                             
## [20] &quot;winner.homeLocation&quot;                                     
## [21] &quot;winner.primaryColor&quot;                                     
## [22] &quot;winner.secondaryColor&quot;                                   
## [23] &quot;winner.game&quot;                                             
## [24] &quot;winner.attributesVersion&quot;                                
## [25] &quot;winner.abbreviatedName&quot;                                  
## [26] &quot;winner.addressCountry&quot;                                   
## [27] &quot;winner.logo&quot;                                             
## [28] &quot;winner.icon&quot;                                             
## [29] &quot;winner.players&quot;                                          
## [30] &quot;winner.secondaryPhoto&quot;                                   
## [31] &quot;winner.type&quot;                                             
## [32] &quot;winner.attributes.city&quot;                                  
## [33] &quot;winner.attributes.hero_image&quot;                            
## [34] &quot;winner.attributes.manager&quot;                               
## [35] &quot;winner.attributes.team_guid&quot;                             
## [36] &quot;bracket.id&quot;                                              
## [37] &quot;bracket.matchConclusionValue&quot;                            
## [38] &quot;bracket.matchConclusionStrategy&quot;                         
## [39] &quot;bracket.winners&quot;                                         
## [40] &quot;bracket.teamSize&quot;                                        
## [41] &quot;bracket.repeatableMatchUps&quot;                              
## [42] &quot;bracket.type&quot;                                            
## [43] &quot;bracket.clientHints&quot;                                     
## [44] &quot;bracket.advantageComparing&quot;                              
## [45] &quot;bracket.thirdPlaceMatch&quot;                                 
## [46] &quot;bracket.allowDraw&quot;                                       
## [47] &quot;bracket.stage.id&quot;                                        
## [48] &quot;bracket.stage.availableLanguages&quot;                        
## [49] &quot;bracket.stage.title&quot;                                     
## [50] &quot;bracket.stage.tournament.id&quot;                             
## [51] &quot;bracket.stage.tournament.availableLanguages&quot;             
## [52] &quot;bracket.stage.tournament.game&quot;                           
## [53] &quot;bracket.stage.tournament.location&quot;                       
## [54] &quot;bracket.stage.tournament.featured&quot;                       
## [55] &quot;bracket.stage.tournament.draft&quot;                          
## [56] &quot;bracket.stage.tournament.handle&quot;                         
## [57] &quot;bracket.stage.tournament.title&quot;                          
## [58] &quot;bracket.stage.tournament.attributesVersion&quot;              
## [59] &quot;bracket.stage.tournament.subEvents&quot;                      
## [60] &quot;bracket.stage.tournament.attributes.program.environment&quot; 
## [61] &quot;bracket.stage.tournament.attributes.program.phase&quot;       
## [62] &quot;bracket.stage.tournament.attributes.program.season_id&quot;   
## [63] &quot;bracket.stage.tournament.attributes.program.type&quot;        
## [64] &quot;bracket.stage.tournament.attributes.program.stage.format&quot;
## [65] &quot;bracket.stage.tournament.attributes.program.stage.number&quot;
## [66] &quot;bracket.stage.tournament.series.id&quot;</code></pre>
<p>OK, so this was also a json but the nifty json package has flattened some of these nested results into columns.<br />
What types of columns do we have left?</p>
<pre class="r"><code>owl_matches_df$content %&gt;% 
  map_chr(class) %&gt;% 
  data.frame() %&gt;% 
  setNames(&quot;var_type&quot;)</code></pre>
<pre><code>##                                                           var_type
## id                                                         integer
## competitors                                                   list
## scores                                                        list
## conclusionValue                                            integer
## conclusionStrategy                                       character
## state                                                    character
## games                                                         list
## clientHints                                                   list
## dateCreated                                                numeric
## flags                                                         list
## handle                                                   character
## startDate                                                  numeric
## endDate                                                    numeric
## showStartTime                                              logical
## showEndTime                                                logical
## winner.id                                                  integer
## winner.availableLanguages                                     list
## winner.handle                                            character
## winner.name                                              character
## winner.homeLocation                                      character
## winner.primaryColor                                      character
## winner.secondaryColor                                    character
## winner.game                                              character
## winner.attributesVersion                                 character
## winner.abbreviatedName                                   character
## winner.addressCountry                                    character
## winner.logo                                              character
## winner.icon                                              character
## winner.players                                                list
## winner.secondaryPhoto                                    character
## winner.type                                              character
## winner.attributes.city                                   character
## winner.attributes.hero_image                               logical
## winner.attributes.manager                                  logical
## winner.attributes.team_guid                              character
## bracket.id                                                 integer
## bracket.matchConclusionValue                               integer
## bracket.matchConclusionStrategy                          character
## bracket.winners                                            integer
## bracket.teamSize                                           integer
## bracket.repeatableMatchUps                                 integer
## bracket.type                                             character
## bracket.clientHints                                           list
## bracket.advantageComparing                               character
## bracket.thirdPlaceMatch                                    logical
## bracket.allowDraw                                          logical
## bracket.stage.id                                           integer
## bracket.stage.availableLanguages                              list
## bracket.stage.title                                      character
## bracket.stage.tournament.id                                integer
## bracket.stage.tournament.availableLanguages                   list
## bracket.stage.tournament.game                            character
## bracket.stage.tournament.location                        character
## bracket.stage.tournament.featured                          logical
## bracket.stage.tournament.draft                             logical
## bracket.stage.tournament.handle                          character
## bracket.stage.tournament.title                           character
## bracket.stage.tournament.attributesVersion               character
## bracket.stage.tournament.subEvents                            list
## bracket.stage.tournament.attributes.program.environment  character
## bracket.stage.tournament.attributes.program.phase        character
## bracket.stage.tournament.attributes.program.season_id    character
## bracket.stage.tournament.attributes.program.type         character
## bracket.stage.tournament.attributes.program.stage.format character
## bracket.stage.tournament.attributes.program.stage.number   integer
## bracket.stage.tournament.series.id                         integer</code></pre>
<p>Seems as though the rabit hole goes all the way down…</p>
<p>Many of these features have sub lists and in them sub dataframes…</p>
<pre class="r"><code>owl_matches_df$content$scores[[1]]</code></pre>
<pre><code>##   value
## 1     0
## 2     4</code></pre>
<p>Scores can be unnested from here and joined to an id</p>
<pre class="r"><code>owl_matches_df$content$competitors[[1]]$id</code></pre>
<pre><code>## [1] 4404 4405</code></pre>
<p>It would seem as though the players field contains all the players, not just the players that played since the game is a 6 player first person shooter:</p>
<pre class="r"><code>owl_matches_df$content$competitors[[1]]$players</code></pre>
<pre><code>## [[1]]
##    flags team.id team.type player.id player.availableLanguages
## 1   NULL    4404      TEAM      5716                        en
## 2   NULL    4404      TEAM      4025                        en
## 3   NULL    4404      TEAM      4490                        en
## 4   NULL    4404      TEAM      4491                        en
## 5   NULL    4404      TEAM      4139                        en
## 6   NULL    4404      TEAM      4488                        en
## 7   NULL    4404      TEAM      4489                        en
## 8   NULL    4404      TEAM      4492                        en
## 9   NULL    4404      TEAM      3661                        en
## 10  NULL    4404      TEAM      4626                        en
## 11  NULL    4404      TEAM      5715                        en
##     player.handle player.name player.homeLocation player.game
## 1       moth.3967        Moth       Worcester, MA   OVERWATCH
## 2       dhak.8567        dhaK               Gijón   OVERWATCH
## 3      super.6832       super        Philadelphia   OVERWATCH
## 4    babybay.7271     BABYBAY         Chicago, IL   OVERWATCH
## 5   sinatraa.3257    sinatraa       Shoreline, WA   OVERWATCH
## 6      leepy.5762      sleepy        Lakeland, FL   OVERWATCH
## 7     danteh.8452      Danteh         Chicago, IL   OVERWATCH
## 8       nomy.1216        Nomy             Tijuana   OVERWATCH
## 9      iddqd.9839       iddqd           Stockholm   OVERWATCH
## 10     nevix.5457       Nevix            Helgenäs   OVERWATCH
## 11 architect.5497   Architect               Seoul   OVERWATCH
##    player.attributesVersion       player.familyName player.givenName
## 1                     1.0.0                    Espe            Grant
## 2                     1.0.0            Martinez Paz           Daniel
## 3                     1.0.0                  DeLisi          Matthew
## 4                     1.0.0               Francisty           Andrej
## 5                     1.0.0                     Won              Jay
## 6                     1.0.0                 Andrews           Nikola
## 7                     1.0.0                    Cruz            Dante
## 8                     1.0.0 Lizarraga Ramirez Osmar            David
## 9                     1.0.0               Dahlström            André
## 10                    1.0.0                Karlsson          Andreas
## 11                    1.0.0                    Park            Minho
##    player.nationality
## 1                  US
## 2                  ES
## 3                  US
## 4                  US
## 5                  US
## 6                  US
## 7                  US
## 8                  MX
## 9                  SE
## 10                 SE
## 11                 KR
##                                                                     player.headshot
## 1  https://bnetcmsus-a.akamaihd.net/cms/page_media/5z/5Z2WUOHSFSBX1521590864746.png
## 2     https://bnetcmsus-a.akamaihd.net/cms/page_media/4Q3H9T4BPAR21512777246918.png
## 3     https://bnetcmsus-a.akamaihd.net/cms/page_media/YUQL4VLXE7PX1512777247831.png
## 4     https://bnetcmsus-a.akamaihd.net/cms/page_media/U9QK0OYK87F01512777246945.png
## 5     https://bnetcmsus-a.akamaihd.net/cms/page_media/GAH625QTQPGC1512777247784.png
## 6     https://bnetcmsus-a.akamaihd.net/cms/page_media/YWYMSL7EOA951512777247847.png
## 7     https://bnetcmsus-a.akamaihd.net/cms/page_media/FD9N9OR9YO7L1512777246926.png
## 8     https://bnetcmsus-a.akamaihd.net/cms/page_media/NFY3Y5MRRO951512777247574.png
## 9     https://bnetcmsus-a.akamaihd.net/cms/page_media/WSFQZ1R6LCJ31512777247534.png
## 10    https://bnetcmsus-a.akamaihd.net/cms/page_media/QCO0N7H8SQFT1512777247525.png
## 11    https://bnetcmsus-a.akamaihd.net/cms/page_media/S02042JXNHF81515718127993.png
##    player.type   player.attributes.heroes player.attributes.player_number
## 1       PLAYER          ana, lucio, mercy                              64
## 2       PLAYER          lucio, mercy, ana                              10
## 3       PLAYER            pharah, roadhog                               1
## 4       PLAYER  soldier-76, mccree, genji                              13
## 5       PLAYER       tracer, zarya, genji                               2
## 6       PLAYER       ana, zenyatta, mercy                              27
## 7       PLAYER      tracer, genji, sombra                               6
## 8       PLAYER         winston, reinhardt                               7
## 9       PLAYER tracer, soldier-76, mccree                              66
## 10      PLAYER       dva, pharah, junkrat                               9
## 11      PLAYER              genji, pharah                               3
##    player.attributes.preferred_slot player.attributes.role
## 1                                 4                support
## 2                                 4                support
## 3                                 2                   flex
## 4                                 0                offense
## 5                                 0                offense
## 6                                 5                support
## 7                                 3                offense
## 8                                 1                   tank
## 9                                 0                offense
## 10                                2                   flex
## 11                             &lt;NA&gt;                offense
##    player.attributes.hero_image player.attributes.hometown
## 1                            NA                       &lt;NA&gt;
## 2                            NA               Gijón, Spain
## 3                            NA Philadelphia, Pennsylvania
## 4                            NA          Chicago, Illionis
## 5                            NA      Shoreline, Washington
## 6                            NA          Lakeland, Flordia
## 7                            NA      Wonder Lake, illinois
## 8                            NA            Tijuana, Mexico
## 9                            NA          Stockholm, Sweden
## 10                           NA          Helgenäs , Sweden
## 11                           NA                       &lt;NA&gt;
## 
## [[2]]
##    flags team.id team.type player.id player.availableLanguages
## 1   NULL    4405      TEAM      4632                        en
## 2   NULL    4405      TEAM      4630                        en
## 3   NULL    4405      TEAM      4635                    en, ko
## 4   NULL    4405      TEAM      4636                    en, ko
## 5   NULL    4405      TEAM      4633                        en
## 6   NULL    4405      TEAM      4634                    en, ko
## 7   NULL    4405      TEAM      4637                        en
## 8   NULL    4405      TEAM      3663                        en
## 9   NULL    4405      TEAM      3983                        en
## 10  NULL    4405      TEAM      4142                        en
## 11  NULL    4405      TEAM      3987                        en
##       player.handle player.name player.homeLocation player.game
## 1   silkthread.9968  Silkthread            Katy, TX   OVERWATCH
## 2  grimreality.4793 Grimreality           Chico, CA   OVERWATCH
## 3        kariv.3355       Kariv               Seoul   OVERWATCH
## 4         fate.1459        Fate               Seoul   OVERWATCH
## 5        verbo.6137       Verbo             Toronto   OVERWATCH
## 6         envy.3537        Envy               Seoul   OVERWATCH
## 7        space.7513       Space   New York City, NY   OVERWATCH
## 8    numlocked.8944   Numlocked      Leamington Spa   OVERWATCH
## 9        unkoe.9342       Unkoe              Nevers   OVERWATCH
## 10   agilities.5443   Agilities           Blairmore   OVERWATCH
## 11        soon.8087        Soon Hangest-En-Santerre   OVERWATCH
##    player.attributesVersion player.familyName player.givenName
## 1                     1.0.0              Wang              Ted
## 2                     1.0.0          Schaefer      Christopher
## 3                     1.0.0               Bak        Young-Seo
## 4                     1.0.0               Koo        Pan-Seung
## 5                     1.0.0           Disalvo          Stefano
## 6                     1.0.0               Lee         Kang-Jae
## 7                     1.0.0           Halpern             Indy
## 8                     1.0.0            Barton        Sebastian
## 9                     1.0.0         Chevasson         Benjamin
## 10                    1.0.0           Girardi            Brady
## 11                    1.0.0           Tarlier          Terence
##    player.nationality
## 1                  US
## 2                  US
## 3                  KR
## 4                  KR
## 5                  CA
## 6                  KR
## 7                  US
## 8                  GB
## 9                  FR
## 10                 CA
## 11                 FR
##                                                                  player.headshot
## 1  https://bnetcmsus-a.akamaihd.net/cms/page_media/WZ8MLSBXCD6E1512776701242.png
## 2  https://bnetcmsus-a.akamaihd.net/cms/page_media/4HL7NR9URCMU1512776701054.png
## 3  https://bnetcmsus-a.akamaihd.net/cms/page_media/6QOV26CVECXE1512776701055.png
## 4  https://bnetcmsus-a.akamaihd.net/cms/page_media/3SWJQYWMYTV11512776700780.png
## 5  https://bnetcmsus-a.akamaihd.net/cms/page_media/GB1BRHQZ4CLL1512776701508.png
## 6  https://bnetcmsus-a.akamaihd.net/cms/page_media/6FAQKR0XRZ821512776700785.png
## 7  https://bnetcmsus-a.akamaihd.net/cms/page_media/BP0XDXDMWZ421512776701354.png
## 8  https://bnetcmsus-a.akamaihd.net/cms/page_media/H4XYM23GR1061512776701073.png
## 9  https://bnetcmsus-a.akamaihd.net/cms/page_media/AAKTVQLMQ0IZ1512776701428.png
## 10 https://bnetcmsus-a.akamaihd.net/cms/page_media/47PKEMP7FWAQ1512776700755.png
## 11 https://bnetcmsus-a.akamaihd.net/cms/page_media/E29MO86JEHJD1512776701352.png
##    player.type player.attributes.hero_image   player.attributes.heroes
## 1       PLAYER                           NA      tracer, genji, mccree
## 2       PLAYER                           NA tracer, mccree, soldier-76
## 3       PLAYER                           NA  zenyatta, ana, widowmaker
## 4       PLAYER                           NA winston, reinhardt, tracer
## 5       PLAYER                           NA          lucio, mercy, ana
## 6       PLAYER                           NA        dva, zarya, roadhog
## 7       PLAYER                           NA        zarya, roadhog, dva
## 8       PLAYER                           NA    winston, reinhardt, dva
## 9       PLAYER                           NA       mercy, zenyatta, ana
## 10      PLAYER                           NA      genji, tracer, pharah
## 11      PLAYER                           NA tracer, widowmaker, mccree
##     player.attributes.hometown player.attributes.player_number
## 1                     Katy, TX                               9
## 2                    Chico, CA                               0
## 3                        Seoul                               7
## 4                        Seoul                               1
## 5                      Toronto                              13
## 6                        Seoul                              10
## 7      New York City, New York                              16
## 8               Leamington Spa                               6
## 9               Nevers, France                              24
## 10               Blairmore, AB                               3
## 11 Hangest-En-Santerre, France                              99
##    player.attributes.preferred_slot player.attributes.role
## 1                                 3                offense
## 2                                 3                offense
## 3                                 1                support
## 4                                 0                   tank
## 5                                 4                support
## 6                                 2                   flex
## 7                              &lt;NA&gt;                   flex
## 8                                 0                   tank
## 9                                 5                support
## 10                                3                offense
## 11                                1                offense</code></pre>
<p>We can see if the match has been played:</p>
<pre class="r"><code>owl_matches_df$content$state</code></pre>
<pre><code>##  [1] &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot;
##  [6] &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot;
## [11] &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot;
## [16] &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot; &quot;CONCLUDED&quot;</code></pre>
<p>At this point we can create an initial frame for each of the overall matchups:</p>
<pre class="r"><code>matches_cleaned_df &lt;- 
  owl_matches_df$content %&gt;% 
  select(id,competitors,scores,state,endDate,winner.name,bracket.id) %&gt;% 
  dplyr::rename(match_id = id) %&gt;% 
  mutate(competitors = competitors %&gt;% map(~.x %&gt;% select(id)))

matches_cleaned_df</code></pre>
<pre><code>##    match_id competitors scores     state      endDate
## 1     10223  4404, 4405   0, 4 CONCLUDED 1.515636e+12
## 2     10224  4408, 4406   0, 4 CONCLUDED 1.515641e+12
## 3     10225  4523, 4409   1, 2 CONCLUDED 1.515650e+12
## 4     10226  4410, 4407   3, 1 CONCLUDED 1.515714e+12
## 5     10227  4524, 4525   3, 2 CONCLUDED 1.515721e+12
## 6     10228  4402, 4403   1, 3 CONCLUDED 1.515728e+12
## 7     10229  4405, 4523   3, 0 CONCLUDED 1.515810e+12
## 8     10230  4407, 4402   0, 4 CONCLUDED 1.515816e+12
## 9     10231  4404, 4408   3, 1 CONCLUDED 1.515823e+12
## 10    10232  4410, 4524   4, 0 CONCLUDED 1.515876e+12
## 11    10233  4403, 4525   3, 1 CONCLUDED 1.515883e+12
## 12    10234  4409, 4406   4, 0 CONCLUDED 1.515891e+12
## 13    10235  4404, 4524   1, 2 CONCLUDED 1.516240e+12
## 14    10236  4407, 4409   0, 4 CONCLUDED 1.516247e+12
## 15    10237  4525, 4408   4, 0 CONCLUDED 1.516253e+12
## 16    10238  4523, 4525   0, 4 CONCLUDED 1.516318e+12
## 17    10239  4403, 4405   3, 0 CONCLUDED 1.516327e+12
## 18    10240  4524, 4406   2, 3 CONCLUDED 1.516335e+12
## 19    10241  4409, 4402   4, 0 CONCLUDED 1.516413e+12
## 20    10242  4408, 4407   0, 4 CONCLUDED 1.516419e+12
##               winner.name bracket.id
## 1     Los Angeles Valiant       2725
## 2  Los Angeles Gladiators       2725
## 3           Seoul Dynasty       2725
## 4         London Spitfire       2725
## 5     Philadelphia Fusion       2725
## 6      New York Excelsior       2725
## 7     Los Angeles Valiant       2725
## 8         Boston Uprising       2725
## 9     San Francisco Shock       2725
## 10        London Spitfire       2725
## 11     New York Excelsior       2725
## 12          Seoul Dynasty       2725
## 13    Philadelphia Fusion       2725
## 14          Seoul Dynasty       2725
## 15        Houston Outlaws       2725
## 16        Houston Outlaws       2725
## 17     New York Excelsior       2725
## 18 Los Angeles Gladiators       2725
## 19          Seoul Dynasty       2725
## 20         Florida Mayhem       2725</code></pre>
<p>The only problem here is that we have to columns with data frames in them so let’s fix that<br />
One way of tidying this is to throw them together by mapping a <code>bind_cols</code> function over them and that allows us to use <code>unnest</code> to go into long format. Think of it as a <code>reduce</code> into another <code>bind_cols</code></p>
<pre class="r"><code>matches_cleaned_df %&lt;&gt;% 
  mutate(match_outcome = pmap(matches_cleaned_df,~bind_cols(..2,..3))) %&gt;% 
  select(-competitors,-scores) %&gt;% 
  unnest() %&gt;% 
  dplyr::rename(team.id = id, match_score = value)
  # mutate(match_outcome = list(competitors,scores) %&gt;% reduce(bind_cols) %&gt;% list())</code></pre>
<p>Inside each of these matches there are games. This is because the match is decided by the team that wins the most of the rounds of games.</p>
<pre class="r"><code>owl_matches_df$content$games[[1]] %&gt;% 
  names</code></pre>
<pre><code>##  [1] &quot;id&quot;                        &quot;number&quot;                   
##  [3] &quot;points&quot;                    &quot;attributesVersion&quot;        
##  [5] &quot;players&quot;                   &quot;state&quot;                    
##  [7] &quot;stats&quot;                     &quot;handle&quot;                   
##  [9] &quot;attributes.instanceID&quot;     &quot;attributes.map&quot;           
## [11] &quot;attributes.mapScore.team1&quot; &quot;attributes.mapScore.team2&quot;</code></pre>
<p>Seems like some useful info here.</p>
<pre class="r"><code>owl_matches_df$content$games[[1]] %&gt;% 
    map_chr(class) %&gt;% 
  data.frame() %&gt;% 
  setNames(&quot;var_type&quot;)</code></pre>
<pre><code>##                            var_type
## id                          integer
## number                      integer
## points                         list
## attributesVersion         character
## players                        list
## state                     character
## stats                       logical
## handle                    character
## attributes.instanceID     character
## attributes.map            character
## attributes.mapScore.team1   integer
## attributes.mapScore.team2   integer</code></pre>
<p>It seems as though we can drop a lot of these columns already. And we can wrangle the data so that it is also on a team level not a game level.<br />
Furthermore; the list of players another level down shows only the players that played. This is crucial! This means we can join player info onto this list and record statistics only when a player plays a game…</p>
<p>Another key insight here is that the order these lists were arranged in is team1 first and then team2 second. I guess to normalize the data structure these teams were not named in the games sub data frames.</p>
<pre class="r"><code>games_cleaned_df &lt;- 
  owl_matches_df$content %&gt;% 
  select(id,games) %&gt;% 
  dplyr::rename(match_id = id) %&gt;%
  mutate(games = games %&gt;% map(~.x %&gt;%
                                 select(
                                   id,
                                   number,
                                   attributes.map,
                                   attributes.mapScore.team1,
                                   attributes.mapScore.team2,
                                   players
                                   ) %&gt;% 
                                 tidyr::gather(
                                   key = &quot;team_tag&quot;,
                                   value = &quot;team_score&quot;,
                                   attributes.mapScore.team1,
                                   attributes.mapScore.team2
                                   ) %&gt;% 
                                 dplyr::rename(game_id = id, game_number = number)
                                 
                                 )) %&gt;% 
  unnest() %&gt;% 
  mutate(players = players %&gt;% map(~.x %&gt;% select(team.id,player.id,player.name))) %&gt;% 
  unnest() %&gt;% 
  tbl_df()
  
games_cleaned_df %&gt;% glimpse</code></pre>
<pre><code>## Observations: 1,968
## Variables: 9
## $ match_id       &lt;int&gt; 10223, 10223, 10223, 10223, 10223, 10223, 10223...
## $ game_id        &lt;int&gt; 5599, 5599, 5599, 5599, 5599, 5599, 5599, 5599,...
## $ game_number    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2,...
## $ attributes.map &lt;chr&gt; &quot;dorado&quot;, &quot;dorado&quot;, &quot;dorado&quot;, &quot;dorado&quot;, &quot;dorado...
## $ team_tag       &lt;chr&gt; &quot;attributes.mapScore.team1&quot;, &quot;attributes.mapSco...
## $ team_score     &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3,...
## $ team.id        &lt;int&gt; 4405, 4404, 4405, 4404, 4404, 4404, 4404, 4404,...
## $ player.id      &lt;int&gt; 3983, 4025, 4142, 4488, 4489, 4491, 4492, 4626,...
## $ player.name    &lt;chr&gt; &quot;Unkoe&quot;, &quot;dhaK&quot;, &quot;Agilities&quot;, &quot;sleepy&quot;, &quot;Danteh...</code></pre>
<p>Unfortunately the api did not include a clear mapping from games to teams for score. One would have to figure out how to join them or realize that the “team1” was always ontop in the matches hierarchy.</p>
<p>Even more disappointing is the fact that the players have no juicy data in here like kills or assists etc.</p>
<p>If this was available one could immediately start joining these tables and train some machine learning models to predict wins, hero picks, find factors associated with winning etc.</p>
</div>
<div id="visualize-some-data" class="section level2">
<h2>Visualize some data!</h2>
<p>Nationality of the players</p>
<pre class="r"><code>players_cleaned_df %&gt;% 
  ggplot(aes(x = player.nationality))+
  geom_bar(aes(fill = player.nationality))</code></pre>
<p><img src="../../posts/Using_e-sports_api_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>nationality by team counting number of players</p>
<pre class="r"><code>players_cleaned_df %&gt;% 
  ggplot(aes(x = competitor.name,group = player.nationality))+
  geom_bar(aes(fill = player.nationality))+
  coord_flip()</code></pre>
<p><img src="../../posts/Using_e-sports_api_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Any correlation between average number of game wins and number of nationalities in a team?</p>
<pre class="r"><code># matches_cleaned_df %&gt;%
games_cleaned_df %&gt;% 
  group_by(match_id,team.id) %&gt;% 
  summarise(team_score = sum(team_score,na.rm = TRUE)) %&gt;% 
  right_join(matches_cleaned_df) %&gt;% 
  # group_by(match_id, winner.name) %&gt;%
  # summarise(nr_wins = max(match_score)) %&gt;%
  right_join(players_cleaned_df, by = c(&quot;winner.name&quot; = &quot;competitor.name&quot;)) %&gt;%
  group_by(winner.name) %&gt;%
  mutate(nr_uniq_nationalities = unique(player.nationality) %&gt;% length) %&gt;%
  summarise(mean_wins = mean(team_score,na.rm = TRUE),
            nr_uniq_nationalities = mean(nr_uniq_nationalities,na.rm = TRUE)) %&gt;%

# players_cleaned_df %&gt;%
  gather(key = &quot;metric&quot;, value = &quot;count&quot;,nr_uniq_nationalities,mean_wins) %&gt;%
  ggplot(aes(x = winner.name, y = count, group = metric, fill = metric))+
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;)+
  coord_flip()</code></pre>
<pre><code>## Joining, by = c(&quot;match_id&quot;, &quot;team.id&quot;)</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<p><img src="../../posts/Using_e-sports_api_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Any correlation between average number of game wins and the map being played?</p>
<pre class="r"><code># matches_cleaned_df %&gt;%
games_cleaned_df %&gt;% 
  group_by(match_id,team.id,attributes.map) %&gt;% 
  summarise(team_score = sum(team_score,na.rm = TRUE)) %&gt;% 
  left_join(matches_cleaned_df) %&gt;% 
  # group_by(match_id, winner.name) %&gt;%
  # summarise(nr_wins = max(match_score)) %&gt;%
  right_join(players_cleaned_df, by = c(&quot;winner.name&quot; = &quot;competitor.name&quot;)) %&gt;%
  group_by(winner.name,attributes.map) %&gt;%
  mutate(nr_uniq_nationalities = unique(player.nationality) %&gt;% length) %&gt;%
  summarise(mean_wins = mean(team_score,na.rm = TRUE),
            nr_uniq_nationalities = mean(nr_uniq_nationalities,na.rm = TRUE)) %&gt;%

# players_cleaned_df %&gt;%
  ggplot(aes(x = attributes.map, y = mean_wins, group = winner.name, fill = winner.name))+
  geom_bar(stat = &quot;identity&quot;)+
  coord_flip()</code></pre>
<pre><code>## Joining, by = c(&quot;match_id&quot;, &quot;team.id&quot;)</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (position_stack).</code></pre>
<p><img src="../../posts/Using_e-sports_api_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.initHighlightingOnLoad();
</script>


        <h2>Comments</h2>
        <div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://statslab.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
<script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

            </div>
        </div>
        
                
    </body>
</html>
